// ADICIONAR NO FINAL DO <script>, ANTES DO FECHAMENTO </script>
// (Aproximadamente após a linha 1200)

        // ==================== HANDLERS GEMINI ====================

        // Salvar API Key
        document.getElementById('btn-save-gemini-key').addEventListener('click', () => {
            const key = document.getElementById('gemini-api-key').value.trim();
            if (!key) {
                alert('⚠️ Digite uma API Key válida');
                return;
            }
            parent.postMessage({ pluginMessage: { type: 'save-gemini-key', key } }, '*');
        });

        // Testar Conexão
        document.getElementById('btn-test-gemini').addEventListener('click', () => {
            parent.postMessage({ pluginMessage: { type: 'test-gemini-connection' } }, '*');
        });

        // Analisar com IA
        document.getElementById('btn-analyze-gemini').addEventListener('click', () => {
            document.getElementById('gemini-results').style.display = 'none';
            parent.postMessage({ pluginMessage: { type: 'analyze-with-gemini' } }, '*');
        });

        // Receber resultados do Gemini (ADICIONAR ao window.addEventListener existente)
        // Procure por: window.addEventListener('message', (event) => {
        // E adicione DENTRO dele, após os outros handlers:

        if (msg.type === 'gemini-connection-result') {
            if (msg.success) {
                alert('✅ Conexão OK! API Key válida.');
            } else {
                alert('❌ Falha na conexão. Verifique a API Key.');
            }
        }

        if (msg.type === 'gemini-creation-complete') {
            const resultsDiv = document.getElementById('gemini-results');
            const improvementsDiv = document.getElementById('gemini-improvements');
            
            resultsDiv.style.display = 'block';
            improvementsDiv.innerHTML = `
                <strong>Frame Original:</strong> ${msg.data.originalName}<br>
                <strong>Novo Frame:</strong> ${msg.data.newName}<br><br>
                <strong>Melhorias:</strong><br>
                ${msg.data.improvements.map(imp => `• ${imp}`).join('<br>')}
            `;
        }

        if (msg.type === 'gemini-error') {
            alert('❌ Erro: ' + msg.error);
        }
